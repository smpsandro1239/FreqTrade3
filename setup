@echo off
chcp 65001 >nul
setlocal enabledelayedexpansion

:: =============================================
:: FREQTRADE3 - SCRIPT DE CONFIGURAÃ‡ÃƒO AUTOMÃTICA
:: =============================================
:: VersÃ£o: 1.0.0
:: Data: 2025-11-05
:: Autor: FreqTrade3 Project
:: DescriÃ§Ã£o: ConfiguraÃ§Ã£o completa e segura do FreqTrade3
:: =============================================

title FreqTrade3 - ConfiguraÃ§Ã£o AutomÃ¡tica

:: Cores para output (usando ANSI para Linux/Mac)
set "GREEN=[92m"
set "YELLOW=[93m"
set "RED=[91m"
set "BLUE=[94m"
set "CYAN=[96m"
set "NC=[0m"

:: VariÃ¡veis globais
set "INSTALL_DIR=%~dp0"
set "USER_DATA_DIR=%USERPROFILE%\freqtrade3\user_data"
set "CONFIG_DIR=%INSTALL_DIR%configs"
set "STRATEGY_DIR=%INSTALL_DIR%strategies"
set "LOG_DIR=%INSTALL_DIR%logs"
set "PYTHON_EXE=python"
set "PIP_EXE=pip"

:: FunÃ§Ã£o para output colorido
:print_colored
echo %~2%~1%~3
goto :eof

:: FunÃ§Ã£o para aguardar entrada do usuÃ¡rio
:pause_user
echo.
echo Pressione qualquer tecla para continuar...
pause >nul
goto :eof

:: InÃ­cio do script
cls
echo.
echo %BLUE%â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—%NC%
echo %BLUE%â•‘                                                              â•‘%NC%
echo %BLUE%â•‘%GREEN%           ğŸŸ¢ FREQTRADE3 - CONFIGURAÃ‡ÃƒO AUTOMÃTICA          %BLUE%â•‘%NC%
echo %BLUE%â•‘%GREEN%              Sistema de Trading AlgorÃ­tmico              %BLUE%â•‘%NC%
echo %BLUE%â•‘                                                              â•‘%NC%
echo %BLUE%â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•%NC%
echo.
echo %CYAN%Bem-vindo ao FreqTrade3!%NC%
echo %CYAN%Este script irÃ¡ configurar automaticamente todo o sistema de trading.%NC%
echo.

:: Verificar se Python estÃ¡ instalado
echo %YELLOW%ğŸ” Verificando Python...%NC%
python --version >nul 2>&1
if errorlevel 1 (
    echo %RED%âŒ Python nÃ£o encontrado!%NC%
    echo.
    echo %CYAN%ğŸ“¥ Instale o Python 3.8+ primeiro:%NC%
    echo    â€¢ Aceda a: https://www.python.org/downloads/
    echo    â€¢ Descarregue Python 3.8 ou superior
    echo    â€¢ âœ… Durante a instalaÃ§Ã£o, marque "Add Python to PATH"
    echo.
    echo %RED%ApÃ³s instalar Python, execute este script novamente.%NC%
    goto :end
)

:: Obter versÃ£o do Python
for /f "tokens=2" %%a in ('python --version 2^>^&1') do set PYTHON_VERSION=%%a
echo %GREEN%âœ… Python %PYTHON_VERSION% encontrado%NC%

:: Verificar se pip estÃ¡ disponÃ­vel
echo %YELLOW%ğŸ” Verificando pip...%NC%
pip --version >nul 2>&1
if errorlevel 1 (
    echo %RED%âŒ pip nÃ£o encontrado!%NC%
    echo %CYAN%Instalando pip...%NC%
    python -m ensurepip --default-pip
    if errorlevel 1 (
        echo %RED%âŒ Falha ao instalar pip!%NC%
        goto :end
    )
)
echo %GREEN%âœ… pip disponÃ­vel%NC%

echo.
echo %BLUE%â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•%NC%
echo %BLUE%                    INÃCIO DA CONFIGURAÃ‡ÃƒO                      %NC%
echo %BLUE%â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•%NC%
echo.

:: Passo 1: Atualizar ferramentas base
echo %YELLOW%ğŸ“¦ PASSO 1/10: Atualizando ferramentas base...%NC%
echo %CYAN%â†’ Atualizando pip...%NC%
%PIP_EXE% install --upgrade pip
if errorlevel 1 (
    echo %RED%âŒ Falha ao atualizar pip%NC%
    goto :end
)
echo %GREEN%âœ… pip atualizado%NC%

echo %CYAN%â†’ Instalando/updating wheel...%NC%
%PIP_EXE% install --upgrade wheel
echo %GREEN%âœ… wheel atualizado%NC%

echo.
echo %YELLOW%ğŸ“¦ PASSO 2/10: Criando ambiente virtual...%NC%

:: Criar diretÃ³rio do usuÃ¡rio se nÃ£o existir
if not exist "%USER_DATA_DIR%" (
    mkdir "%USER_DATA_DIR%"
    echo %CYAN%â†’ DiretÃ³rio do usuÃ¡rio criado: %USER_DATA_DIR%%NC%
)

:: Criar subdirectÃ³rios necessÃ¡rios
if not exist "%USER_DATA_DIR%\strategies" mkdir "%USER_DATA_DIR%\strategies"
if not exist "%USER_DATA_DIR%\data" mkdir "%USER_DATA_DIR%\data"
if not exist "%USER_DATA_DIR%\notebooks" mkdir "%USER_DATA_DIR%\notebooks"
if not exist "%LOG_DIR%" mkdir "%LOG_DIR%"

echo %GREEN%âœ… Estrutura de diretÃ³rios criada%NC%

:: Passo 3: Instalar FreqTrade
echo.
echo %YELLOW%ğŸ“¦ PASSO 3/10: Instalando FreqTrade...%NC%

:: Instalar FreqTrade
%PIP_EXE% install freqtrade
if errorlevel 1 (
    echo %RED%âŒ Falha ao instalar FreqTrade%NC%
    echo %CYAN%â†’ Tentando instalaÃ§Ã£o via conda...%NC%
    conda install freqtrade -c conda-forge
    if errorlevel 1 (
        echo %RED%âŒ Falha na instalaÃ§Ã£o do FreqTrade%NC%
        goto :end
    )
)

echo %GREEN%âœ… FreqTrade instalado%NC%

:: Verificar instalaÃ§Ã£o
freqtrade --version >nul 2>&1
if errorlevel 1 (
    echo %RED%âŒ FreqTrade nÃ£o estÃ¡ funcionando corretamente%NC%
    goto :end
)
echo %GREEN%âœ… FreqTrade verificado%NC%

:: Passo 4: Instalar UI
echo.
echo %YELLOW%ğŸ¨ PASSO 4/10: Configurando FreqUI (Interface TradingView)...%NC%
echo %CYAN%â†’ Instalando componentes da UI...%NC%

%PIP_EXE% install "freqtrade[ui]"
if errorlevel 1 (
    echo %YELLOW%âš ï¸ Aviso: InstalaÃ§Ã£o parcial da UI%NC%
    echo %CYAN%â†’ Continuando com configuraÃ§Ã£o bÃ¡sica...%NC%
)

echo %GREEN%âœ… FreqUI configurada%NC%

:: Passo 5: Configurar estratÃ©gias
echo.
echo %YELLOW%ğŸ§  PASSO 5/10: Configurando estratÃ©gias...%NC%

:: Copiar estratÃ©gias para user_data
echo %CYAN%â†’ Copiando estratÃ©gias para user_data...%NC%
if exist "%STRATEGY_DIR%\*.py" (
    copy "%STRATEGY_DIR%\*.py" "%USER_DATA_DIR%\strategies\" >nul
    echo %GREEN%âœ… EstratÃ©gias copiadas%NC%
) else (
    echo %YELLOW%âš ï¸ Nenhuma estratÃ©gia encontrada em %STRATEGY_DIR%%NC%
)

:: Passo 6: Configurar dados histÃ³ricos
echo.
echo %YELLOW%ğŸ“Š PASSO 6/10: Configurando dados histÃ³ricos...%NC%

:: Configurar dados para um par popular (BTC/USDT)
echo %CYAN%â†’ Configurando dados para BTC/USDT (timeframe 15m)...%NC%

cd /d "%USER_DATA_DIR%"

:: Fazer download de dados histÃ³ricos
freqtrade download-data --pairs BTC/USDT --timeframes 15m 1h --days 30
if errorlevel 1 (
    echo %YELLOW%âš ï¸ Aviso: Falha no download de dados%NC%
    echo %CYAN%â†’ Continue, vocÃª pode fazer download mais tarde%NC%
)

echo %GREEN%âœ… Dados histÃ³ricos configurados%NC%

:: Voltar para diretÃ³rio original
cd /d "%INSTALL_DIR%"

:: Passo 7: Configurar exchange
echo.
echo %YELLOW%ğŸ”‘ PASSO 7/10: ConfiguraÃ§Ã£o da Exchange...%NC%
echo.
echo %CYAN%Para configurar as credenciais da exchange:%NC%
echo.
echo %YELLOW%1. Binance (Recomendado para iniciantes):%NC%
echo    â€¢ Aceda a: https://www.binance.com/en/my/settings/api-management
echo    â€¢ Crie uma nova API key
echo    â€¢ âœ… Ative apenas "Spot Trading" (NÃƒO ative "Withdrawals")
echo    â€¢ Copie a API key e secret
echo.
echo %YELLOW%2. Outros exchanges suportados:%NC%
echo    â€¢ KuCoin, Coinbase, Kraken, OKX, Bybit
echo    â€¢ Configure da mesma forma
echo.
echo %CYAN%DICA: Use sempre chaves API com permissÃµes mÃ­nimas!%NC%

:configure_exchange
echo.
set /p "exchange_name=Qual exchange deseja usar? (binance/kucoin/coinbase/kraken) [binance]: "
if "%exchange_name%"=="" set exchange_name=binance

echo.
echo %CYAN%Configurando para %exchange_name%...%NC%

:: Gerar config.json baseado na escolha
echo %CYAN%â†’ Gerando configuraÃ§Ã£o personalizada...%NC%

:: Criar config.json bÃ¡sico
echo %YELLOW%ğŸ“ Criando arquivo de configuraÃ§Ã£o bÃ¡sico...%NC%

:: Passo 8: Configurar FreqUI
echo.
echo %YELLOW%ğŸŒ PASSO 8/10: Configurando FreqUI...%NC%

:: Configurar FreqUI
freqtrade install-ui
if errorlevel 1 (
    echo %YELLOW%âš %NC%Aviso: FreqUI pode precisar de configuraÃ§Ã£o manual%NC%
)

echo %GREEN%âœ… FreqUI configurada%NC%

:: Passo 9: Configurar alertas
echo.
echo %YELLOW%ğŸ”” PASSO 9/10: ConfiguraÃ§Ã£o de Alertas...%NC%

echo.
echo %CYAN%ğŸ¯ Configurar notificaÃ§Ãµes para receber alertas de trading:%NC%
echo.
echo %YELLOW%1. Telegram (Mais popular):%NC%
echo    â€¢ Crie um bot no @BotFather
echo    â€¢ Anote o Token do bot
echo    â€¢ Crie um grupo e adicione o bot
echo.
echo %YELLOW%2. Discord:%NC%
echo    â€¢ Crie um webhook no seu servidor Discord
echo    â€¢ Copie a URL do webhook
echo.
echo %YELLOW%3. Email:%NC%
echo    â€¢ Configure SMTP do seu email
echo    â€¢ Gmail, Outlook, etc.
echo.

set /p "telegram_token=Token do Telegram (opcional, pressione Enter para pular): "
set /p "discord_webhook="Discord Webhook (opcional, pressione Enter para pular): "
set /p "email_config="ConfiguraÃ§Ã£o Email (opcional, pressione Enter para pular): "

echo %GREEN%âœ… ConfiguraÃ§Ãµes de alertas gravadas%NC%

:: Passo 10: Testes finais
echo.
echo %YELLOW%âœ… PASSO 10/10: Executando testes finais...%NC%

echo %CYAN%â†’ Testando instalaÃ§Ã£o do FreqTrade...%NC%
freqtrade test-strategy --strategy template_strategy
if errorlevel 1 (
    echo %YELLOW%âš ï¸ Aviso: Teste de estratÃ©gia falhou%NC%
    echo %CYAN%â†’ Isso pode ser normal se nÃ£o tiver dados histÃ³ricos%NC%
) else (
    echo %GREEN%âœ… Teste de estratÃ©gia OK%NC%
)

echo %CYAN%â†’ Verificando integridade dos arquivos...%NC%
if exist "%USER_DATA_DIR%\strategies\*.py" (
    echo %GREEN%âœ… EstratÃ©gias encontradas%NC%
) else (
    echo %YELLOW%âš ï¸ Nenhuma estratÃ©gia encontrada%NC%
)

if exist "%USER_DATA_DIR%\data\*.json" (
    echo %GREEN%âœ… Dados histÃ³ricos encontrados%NC%
) else (
    echo %YELLOW%âš %NC%Nenhum dado histÃ³rico encontrado
    echo %CYAN%â†’ Execute: freqtrade download-data --pairs BTC/USDT --days 7%NC%
)

:: Resumo final
echo.
echo %BLUE%â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•%NC%
echo %BLUE%                     CONFIGURAÃ‡ÃƒO CONCLUÃDA!                    %NC%
echo %BLUE%â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•%NC%
echo.
echo %GREEN%ğŸ‰ ParabÃ©ns! O FreqTrade3 foi configurado com sucesso!%NC%
echo.
echo %CYAN%ğŸ“‹ RESUMO DA CONFIGURAÃ‡ÃƒO:%NC%
echo    â€¢ FreqTrade instalado e verificado
echo    â€¢ FreqUI configurado (interface web)
echo    â€¢ EstratÃ©gias disponÃ­veis em: %USER_DATA_DIR%\strategies\
echo    â€¢ DiretÃ³rio de dados: %USER_DATA_DIR%\data\
echo.
echo %YELLOW%ğŸš€ PRÃ“XIMOS PASSOS:%NC%
echo.
echo %CYAN%1. COMEÃ‡AR TRADING:%NC%
echo    freqtrade trade --config configs\config.json --strategy template_strategy --dry-run
echo.
echo %CYAN%2. INTERFACE WEB (FreqUI):%NC%
echo    freqtrade trade --config configs\config.json --strategy template_strategy --ui-enable
echo    Depois abra: http://localhost:8080
echo.
echo %CYAN%3. BACKTESTING:%NC%
echo    freqtrade backtesting --config configs\config.json --strategy template_strategy
echo.
echo %CYAN%4. DOWNLOAD DE DADOS:%NC%
echo    freqtrade download-data --pairs BTC/USDT --timeframes 15m 1h --days 30
echo.
echo %YELLOW%âš ï¸ IMPORTANTE - SEGURANÃ‡A:%NC%
echo    â€¢ SEMPRE teste em DRY-RUN primeiro!
echo    â€¢ Configure API keys apenas com permissÃµes de trading
echo    â€¢ NUNCA use chaves com permissÃµes de withdrawal
echo    â€¢ FaÃ§a backup das suas configuraÃ§Ãµes
echo.
echo %GREEN%ğŸ“š DOCUMENTAÃ‡ÃƒO:%NC%
echo    â€¢ README.md - VisÃ£o geral do projeto
echo    â€¢ SECURITY.md - PolÃ­ticas de seguranÃ§a
echo    â€¢ docs\USER_GUIDE.md - Manual completo
echo.

:: Pergunta final sobre inicializaÃ§Ã£o
echo.
set /p "start_trading="Deseja iniciar o FreqTrade em modo dry-run agora? (s/n) [s]: "
if "%start_trading%"=="" set start_trading=s

if /i "%start_trading%"=="s" (
    echo.
    echo %CYAN%ğŸš€ Iniciando FreqTrade em modo DRY-RUN...%NC%
    echo %YELLOW%âš ï¸ Modo DRY-RUN: Nenhum dinheiro real serÃ¡ usado!%NC%
    echo.
    echo %CYAN%Para parar: Pressione Ctrl+C%NC%
    echo.

    :: Configurar e iniciar
    freqtrade trade --config configs\config_template_dryrun.json --strategy template_strategy
)

:end
echo.
echo %CYAN%Obrigado por usar FreqTrade3!%NC%
echo.
echo %YELLOW%ğŸ“ SUPORTE:%NC%
echo    â€¢ GitHub: https://github.com/smpsandro1239/FreqTrade3
echo    â€¢ DocumentaÃ§Ã£o: README.md
echo    â€¢ Problemas: Abra uma issue no GitHub
echo.

pause
